[< back to README](https://github.com/truefootprint/field-backend#readme)

## Overview

The FieldBackend's primary function is to serve the
[FieldApp](https://github.com/truefootprint/field-app). This document gives a
brief explanation of the different endpoints.

### POST /tokens

When the user logs into the app with their phone number, we send a request to
this endpoint to create an API token for them if the phone number matched a user
record in the database.

### GET /my_data

This endpoint contains the vast majority of data needed by the app to present
projects to the user. It contains projects, activities, questions, responses,
issues, etc. It is presented in a hierarchical structure which is directly fed
into the React component hierarchy in the FieldApp. This data is translated
into the locale requested by the user's device.

### POST /my_updates

This endpoint receives a batch of responses and issues that have been created
by the user in the FieldApp. It processes this batch and creates/updates records
in the database on behalf of the user. The batch is chunked by submission date,
meaning responses to the same questions across multiple days are processed
separately, ensuring that multiple responses are created in the database.

### POST /my_photos

Image binary data is uploaded to the /my_photos endpoint. It is currently stored
on the server in the `storage/` directory. The /my_data endpoint contains links
to these static files which are downloaded asynchronously in the FieldApp.

### POST /change_roles

For some scenarios, we want the user to be able to specify their role in the
FieldApp, rather than have it predetermined for them. For example, in the COVID
example, we have roles like 'Patient' and 'Health specialist'. Initially, these
users start with an 'unspecified' role and they can then change it by a request
to the /change_roles endpoint.

### POST /my_registrations

This endpoint isn't currently used for anything except a feature test. It
dynamically registers a user for a project activity, which is to cater for a
scenario where a user self-registers to attend a training workshop. See the
documentation on [Visibility](./visibility.md) for more information about this
scenario.

### GET /translations

This endpoint is used when building the FieldApp. It serves a list of
translations that are 'baked into' the app. These translations appear before the
user has logged in and pulled personalised translations down for them.

### CRUD resources

In addition to the endpoints listed above, almost all models can be managed
through the
[CrudController](https://github.com/truefootprint/field-backend/blob/master/app/controllers/crud_controller.rb).
These routes are dynamically generated by the
constants in [config/routes.rb](https://github.com/truefootprint/field-backend/blob/master/config/routes.rb).
The responses are formatted to be compatible with the react-admin framework
used in the [FieldAdmin](https://github.com/truefootprint/field-admin) application.


[< back to README](https://github.com/truefootprint/field-backend#readme)
